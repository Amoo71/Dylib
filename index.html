<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ultimate Video Ripper Player (Dark Mode)</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css">
  <script src="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body {
      margin: 0;
      padding: 10px;
      background: #0a0a0a;
      color: white;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    .player-container {
      width: 90%;
      max-width: 900px;
      padding: 20px;
      border-radius: 15px;
      background: rgba(20, 20, 20, 0.6);
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.6);
    }
    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
    }
    input {
      flex: 1;
      padding: 12px;
      border-radius: 8px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      color: #eee;
      font-size: 16px;
    }
    input:focus {
      outline: none;
      background: rgba(255, 255, 255, 0.2);
    }
    button {
      padding: 12px 20px;
      border-radius: 8px;
      border: none;
      background: #00bfff;
      color: black;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background: #00dfff;
    }
    button:disabled {
      background: #555;
      cursor: not-allowed;
    }
    .plyr__controls {
      background-color: rgba(0, 0, 0, 0.7);
      border-radius: 10px;
    }
    @media (max-width: 600px) {
      .player-container {
        width: 96%;
        padding: 12px;
      }
      .input-group {
        flex-direction: column;
      }
      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="player-container">
    <div class="input-group">
      <input type="text" id="url" placeholder="YouTube, Southpark.de, Vimeo, Streamcloud, any page with video">
      <button id="searchBtn">Rip & Play</button>
    </div>
    <video id="player" controls preload="auto" crossorigin playsinline>
      Your browser does not support the video tag.
    </video>
  </div>

  <script>
    const input = document.getElementById('url');
    const searchBtn = document.getElementById('searchBtn');
    const video = document.getElementById('player');

    const player = new Plyr(video, {
      controls: ['play-large', 'restart', 'rewind', 'play', 'fast-forward', 'progress', 'current-time', 'duration', 'mute', 'volume', 'captions', 'settings', 'pip', 'airplay', 'fullscreen'],
      autoplay: false,
      hideControls: true,
      fullscreen: { enabled: true, fallback: true, iosNative: true },
      youtube: { noCookie: true, rel: 0, showinfo: 0, iv_load_policy: 3, modestbranding: 1 },
      vimeo: { byline: false, portrait: false, title: false, speed: true, transparent: false }
    });

    // Updated 2026 proxy arsenal – more firepower, less failures
    const proxies = [
      url => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
      url => `https://corsproxy.io/?${encodeURIComponent(url)}`,
      url => `https://thingproxy.freeboard.io/fetch/${encodeURIComponent(url)}`,
      url => `https://cors.sh/${encodeURIComponent(url)}`,
      url => `https://cors.lol/${encodeURIComponent(url)}`
    ];

    async function fetchWithProxy(targetUrl) {
      let lastError;
      for (const proxyFn of proxies) {
        try {
          const proxyUrl = proxyFn(targetUrl);
          const response = await fetch(proxyUrl, { signal: AbortSignal.timeout(10000) }); // 10s timeout
          if (response.ok) return await response.text();
        } catch (e) {
          lastError = e;
          continue;
        }
      }
      throw lastError || new Error('All proxies failed – try a direct video link or check connection');
    }

    const startSearch = async () => {
      let url = input.value.trim();
      if (!url) return;

      searchBtn.disabled = true;
      searchBtn.textContent = 'Ripping...';

      try {
        // Direct YouTube/Vimeo
        if (url.includes('youtube.com') || url.includes('youtu.be')) {
          const videoId = url.match(/(?:v=|youtu\.be\/|embed\/)([^?&"'>]+)/)?.[1] || url.split('v=')[1]?.split('&')[0];
          player.source = { type: 'youtube', sources: [{ src: videoId }] };
          player.play();
          return;
        }
        if (url.includes('vimeo.com')) {
          const videoId = url.split('/').pop().split('?')[0];
          player.source = { type: 'vimeo', sources: [{ src: videoId }] };
          player.play();
          return;
        }

        // Direct video files
        if (url.match(/\.(mp4|webm|ogg|mkv|mov|avi|m3u8|ts)$/i)) {
          const isHls = url.match(/\.m3u8|ts$/i);
          player.source = {
            type: 'video',
            sources: [{ src: url, type: isHls ? 'application/x-mpegURL' : 'video/mp4' }]
          };
          player.play();
          return;
        }

        // Fetch page & extract
        const html = await fetchWithProxy(url);
        const doc = new DOMParser().parseFromString(html, 'text/html');

        let candidates = new Set();

        // Meta + tags
        [...doc.querySelectorAll('meta[property="og:video"], meta[property="og:video:url"], meta[property="og:video:secure_url"], meta[name="twitter:player:stream"], video source, video, iframe')].forEach(el => {
          const content = el.content || el.src || el.getAttribute('src');
          if (content) candidates.add(content);
        });

        // Regex blitz
        const regexPatterns = [
          /["'](https?:\/\/[^"']+\.(mp4|webm|m3u8|ts|mkv|mov|avi)[^"']*)["']/gi,
          /(https?:\/\/(www\.)?youtube\.com\/watch\?v=[^"'\s>&]+)["'\s>&]/gi,
          /(https?:\/\/youtu\.be\/[^"'\s>&]+)["'\s>&]/gi,
          /(https?:\/\/(player\.)?vimeo\.com\/video\/[^"'\s>&]+)["'\s>&]/gi
        ];
        regexPatterns.forEach(regex => {
          let match;
          while ((match = regex.exec(html)) !== null) {
            candidates.add(match[1] || match[0]);
          }
        });

        // Pick the best
        let bestSrc = null;
        let bestType = 'video/mp4';
        for (let src of candidates) {
          if (!src.startsWith('http')) src = new URL(src, url).href;

          if (src.includes('youtube.com') || src.includes('youtu.be')) {
            const videoId = src.match(/(?:v=|youtu\.be\/)([^?&"'>]+)/)?.[1];
            player.source = { type: 'youtube', sources: [{ src: videoId }] };
            player.play();
            return;
          }
          if (src.includes('vimeo.com')) {
            const videoId = src.split('/').pop().split('?')[0];
            player.source = { type: 'vimeo', sources: [{ src: videoId }] };
            player.play();
            return;
          }
          if (src.match(/\.m3u8|ts$/i)) bestType = 'application/x-mpegURL';
          if (src.endsWith('.webm')) bestType = 'video/webm';

          if (!bestSrc || src.length > bestSrc.length) {
            bestSrc = src;
          }
        }

        if (bestSrc) {
          player.source = { type: 'video', sources: [{ src: bestSrc, type: bestType }] };
          player.play();
        } else {
          alert('No video found after deep rip. Site might be locked tight – grab the direct link from DevTools (Network tab > Media).');
        }
      } catch (err) {
        alert('Rip failed: ' + err.message + '\nProxies blocked? Try direct .mp4/.m3u8 link or a different site.');
      } finally {
        searchBtn.disabled = false;
        searchBtn.textContent = 'Rip & Play';
      }
    };

    searchBtn.addEventListener('click', startSearch);
    input.addEventListener('keydown', (e) => { if (e.key === 'Enter') startSearch(); });
  </script>
</body>
</html>
